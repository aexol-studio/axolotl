---
name: frontend-translations
description: Frontend translations with @aexol/dynamite - useDynamite hook, t() function, factory patterns for data/schemas, cookie-based locale
---

## Translation with @aexol/dynamite

**Key concept:** The English text IS the key. `t('Hello World')` returns the translated string, or the key itself when no translation exists (English fallback).

```typescript
import { useDynamite } from '@aexol/dynamite';

const MyComponent = () => {
  const { t } = useDynamite();
  return <h1>{t('Hello World')}</h1>;
};

// Interpolation — {{var}} mustache syntax
t('Welcome, {{name}}', { name: 'John' });
t('Your Todos ({{count}})', { count: todos.length });
```

---

## Factory Pattern (Data Files & Zod Schemas)

Files that can't use hooks accept `t` as a parameter:

```typescript
// Landing.data.ts
export const getFeatures = (t: (key: string) => string) => [
  { title: t('Feature One'), description: t('Built-in support for X.') },
];

// Examples.schema.ts
export const createContactSchema = (t: (key: string) => string) =>
  z.object({
    name: z.string().min(2, t('Name must be at least 2 characters')),
    email: z.string().email(t('Please enter a valid email address')),
  });

export type ContactFormValues = z.infer<ReturnType<typeof createContactSchema>>;
```

Call factories inside components where `t` is available:

```typescript
const { t } = useDynamite();
const features = getFeatures(t);
const form = useForm({ resolver: zodResolver(createContactSchema(t)) });
```

---

## Language Switching (Cookie-Based)

- Locale stored in a **`locale` cookie** — NOT localStorage, NOT Zustand
- `LanguageSwitcher` sets cookie + `window.location.reload()`
- Server reads cookie → loads correct translations → SSR renders correct language
- `SUPPORTED_LOCALES` whitelist in `backend/src/lib/cookies.ts` — to add a new language:
  1. Add the locale code to the `SUPPORTED_LOCALES` array (e.g., `'de'`, `'fr'`)
  2. Create `frontend/public/locales/{locale}/common.json` (copy from `en/common.json`)
  3. Restart the dev server — `@aexol/vite-plugin-dev-translate` auto-translates the new file
- Use `locale` from `useDynamite()` for date formatting — map to BCP 47 tags:

```typescript
const LOCALE_MAP: Record<string, string> = { en: 'en-US', pl: 'pl-PL' }; // extend as needed

const { t, locale } = useDynamite();
new Date(d).toLocaleDateString(LOCALE_MAP[locale] ?? locale, { year: 'numeric', month: 'long', day: 'numeric' });
```

---

## Locale Files

- English source: `frontend/public/locales/en/common.json`
- Other locales (e.g., `pl`) auto-generated by `@aexol/vite-plugin-dev-translate` during dev
- **Generated translations ARE committed to git** (needed for production/CI)
- Format: flat JSON `{ "English text": "English text" }` — key = value = English
- Pattern for each locale: `frontend/public/locales/{locale}/common.json`
- Add key to `en/common.json` → restart dev server → all other locale files auto-update

---

## What NOT to Translate

Brand/tech names: Axolotl, GraphQL, Zeus, React, TypeScript, shadcn/ui, Vite, Prisma, Zustand, Sonner.
Code snippets, email placeholders, URLs.

**Files outside React tree** (`api/errors.ts`, `lib/queryClient.ts`) — can't call `useDynamite()`. Leave strings in English.

---

## Key Rules

1. Key = English text (flat, no nesting)
2. ALWAYS use arrow functions in components
3. Factory pattern for data files and Zod schemas
4. Cookie for locale, NOT localStorage
5. Use `locale` from `useDynamite()` for date formatting
6. Commit generated translations to git
7. NEVER manually edit non-English locale files (e.g., `pl/common.json`) — they're auto-generated

---

## Quick Reference

| Task                     | Code                                                                          |
| ------------------------ | ----------------------------------------------------------------------------- |
| Translate string         | `const { t } = useDynamite(); t('My String')`                                 |
| Interpolation            | `t('Hello {{name}}', { name: value })`                                        |
| Get locale               | `const { locale } = useDynamite()`                                            |
| Data file factory        | `export const getData = (t: (key: string) => string) => [{ title: t('X') }]`  |
| Zod schema factory       | `export const createSchema = (t: (key: string) => string) => z.object({...})` |
| Type from schema factory | `type Values = z.infer<ReturnType<typeof createSchema>>`                      |
| Add translation key      | Add `"My Key": "My Key"` to `en/common.json`, restart dev server              |
| Add new locale           | Add to `SUPPORTED_LOCALES`, create `locales/{code}/common.json`, restart dev  |
| Import                   | `import { useDynamite } from '@aexol/dynamite'`                               |

## Troubleshooting

### String shows English instead of translation

Check `en/common.json` has the exact key, restart dev server for plugin to generate translations in other locale files.

### Zod messages not translating

Schema must use factory pattern — static schemas bake in messages at import time.

### New locale not recognized

Add locale code to `SUPPORTED_LOCALES` in `backend/src/lib/cookies.ts`, create `frontend/public/locales/{locale}/common.json`, and restart the dev server.
